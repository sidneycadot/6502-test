
.PHONY : default clean show

CFLAGS = -W -Wall -O3
LDFLAGS = -s

# The datafiles were originally recorded in hardware (Atari 800XL and Neo6502), but can also
# be generated by the "make_reference_files" program, which reproduces them perfectly.
DATAFILES = adc_sbc_6502.dat adc_sbc_65c02.dat

default : test_6502_adc_sbc $(DATAFILES)
	./test_6502_adc_sbc

show : testcases.npy $(DATAFILES)
	./show_testcases.py

$(DATAFILES) : make_reference_files MD5SUM
	./make_reference_files
	md5sum -c MD5SUM

make_reference_files : make_reference_files.o 6502_adc_sbc.o

test_6502_adc_sbc : 6502_adc_sbc.o 6502_adc_sbc.o

find_cpu_signature : find_cpu_signature.o 6502_adc_sbc.o

test_6502_adc_sbc.o : test_6502_adc_sbc.c 6502_adc_sbc.h

find_cpu_signature.o : find_cpu_signature.c 6502_adc_sbc.h

6502_adc_sbc.o : 6502_adc_sbc.c 6502_adc_sbc.h


testcases.npy : preprocess.py $(DATAFILES)
	./preprocess.py

clean :
	$(RM) test_6502_adc_sbc make_reference_files testcases.npy find_cpu_signature *.o *~ $(DATAFILES)
